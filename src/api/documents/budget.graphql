# Queries para presupuestos
query GetBudgets(
    $search: String
    $clientId: [String!]
    $businessId: [String!]
    $skip: Int
    $take: Int
    $orderBy: String
    $orderDirection: String
) {
    budgets(
        search: $search
        clientId: $clientId
        businessId: $businessId
        skip: $skip
        take: $take
        orderBy: $orderBy
        orderDirection: $orderDirection
    ) {
        id
        budgetNumber
        subject
        description
        price
        status
        clientName
        createdAt
        updatedAt
        expectedExpenses {
            type
            unitPrice
            quantity
            amount
        }
        manpower {
            technician
            payAmount
        }
        markup
        totalExpectedExpenses
        billingProfile {
            id
            business {
                id
                name
            }
        }
        client {
            id
            name
        }
        branch {
            id
            name
            number
        }
        createdBy {
            id
            fullName
        }
    }
    budgetsCount(search: $search)
}

query GetBudgetById($id: String!) {
    budgetById(id: $id) {
        id
        budgetNumber
        subject
        description
        price
        status
        clientName
        createdAt
        updatedAt
        expectedExpenses {
            type
            unitPrice
            quantity
            amount
        }
        manpower {
            technician
            payAmount
        }
        markup
        budgetBranch {
            name
            number
        }
        totalExpectedExpenses
        billingProfile {
            id
            legalName
            tipoDocumento
            numeroDocumento
            IVACondition
            comercialAddress
            billingEmails
            contacts {
                email
                fullName
                phone
                notes
            }
            business {
                id
                name
            }
        }
        client {
            id
            name
        }
        branch {
            id
            name
            number
        }
        createdBy {
            id
            fullName
        }
    }
}

# Query para buscar cadenas de mail por asunto
query SearchGmailThreads($query: String) {
    searchBudgetThreads(query: $query) {
        success
        message
        threads {
            id
            subject
            snippet
            historyId
            messages {
                id
                threadId
                labelIds
                snippet
            }
        }
    }
}

# Query para buscar empresas con sus perfiles de facturaci√≥n
query GetBusinessesWithBillingProfiles($search: String, $skip: Int, $take: Int) {
    businesses(search: $search, skip: $skip, take: $take) {
        id
        name
        billingProfile {
            id
            legalName
            tipoDocumento
            numeroDocumento
            IVACondition
            billingEmails
            comercialAddress
        }
    }
}

# Query para traer sucursales de un cliente que trabajen con una empresa
query GetClientBranchesByBusiness($clientId: String!, $businessId: String!) {
    clientBranchesByBusiness(clientId: $clientId, businessId: $businessId) {
        id
        name
        number
        city {
            id
            name
            province {
                id
                name
            }
        }
    }
}

# Mutations para presupuestos
mutation CreateBudget($input: BudgetInput!) {
    createBudget(input: $input) {
        success
        message
        budget {
            id
            subject
            description
            price
            status
            createdAt
            billingProfile {
                id
                legalName
                business {
                    id
                    name
                }
            }
            client {
                id
                name
            }
            branch {
                id
                name
                number
            }
            createdBy {
                id
                fullName
            }
        }
    }
}

mutation UpdateBudget($id: String!, $input: UpdateBudgetInput!) {
    updateBudget(id: $id, input: $input) {
        success
        message
        budget {
            id
            subject
            description
            price
            status
            updatedAt
            billingProfile {
                id
                legalName
                business {
                    id
                    name
                }
            }
            client {
                id
                name
            }
            branch {
                id
                name
                number
            }
        }
    }
}

mutation DeleteBudget($id: String!) {
    deleteBudget(id: $id) {
        success
        message
    }
}

mutation UpdateBudgetStatus($id: String!, $input: UpdateBudgetStatusInput!) {
    updateBudgetStatus(id: $id, input: $input) {
        success
        message
        budget {
            id
            subject
            description
            price
            status
            createdAt
            updatedAt
            billingProfile {
                id
                business {
                    id
                    name
                }
            }
            createdBy {
                id
                fullName
            }
        }
    }
}

mutation CreateBudgetWithBillingProfile($input: CreateBudgetWithBillingProfileInput!) {
    createBudgetWithBillingProfile(input: $input) {
        success
        message
        budget {
            id
            subject
            description
            price
            status
            createdAt
            billingProfile {
                id
                legalName
                business {
                    id
                    name
                }
            }
            client {
                id
                name
            }
            branch {
                id
                name
                number
            }
            createdBy {
                id
                fullName
            }
        }
    }
}
